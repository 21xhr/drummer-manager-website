<div id="login-overlay">
    <form id="login-form" class="card" onsubmit="unlock(event)">
        <h3>Enter Admin Key</h3>
        <input type="password" id="admin-key-input" name="password" 
               placeholder="••••••••" autocomplete="current-password"
               style="padding: 10px; width: 100%; margin-bottom: 10px;">
        <button type="submit" style="width: 100%; padding: 10px; cursor: pointer;">
            Access Console
        </button>
    </form>
</div>

<script>
    // ... getApiBaseUrl stays the same ...

    function unlock(event) {
        if (event) event.preventDefault(); // Prevent page reload
        const key = document.getElementById('admin-key-input').value;
        if (key) {
            sessionStorage.setItem('dmg_admin_key', key);
            checkAuthAndLoad();
        }
    }

    async function updateDashboard() {
        const key = sessionStorage.getItem('dmg_admin_key');
        if (!key) return;

        try {
            const res = await fetch(`${API_BASE_URL}/admin/pulse`, {
                headers: { 'X-Admin-Secret': key }
            });
            
            if (res.status === 401) {
                alert("Invalid Admin Key");
                sessionStorage.removeItem('dmg_admin_key');
                location.reload();
                return;
            }

            const data = await res.json();
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('admin-content').style.display = 'block';

            // UI Updates
            document.getElementById('db-status').textContent = data.health.supabase ? 'ONLINE' : 'OFFLINE';
            document.getElementById('db-status').style.color = data.health.supabase ? '#00ff00' : '#ff0000';
            document.getElementById('redis-status').textContent = data.health.upstash ? 'ONLINE' : 'OFFLINE';
            document.getElementById('redis-status').style.color = data.health.upstash ? '#00ff00' : '#ff0000';
            
            document.getElementById('real-day').textContent = data.maintenance.daysSinceInception;
            document.getElementById('stream-day').textContent = data.maintenance.streamDaysSinceInception;
            document.getElementById('chest').textContent = data.financials.totalToCommunityChest.toLocaleString();
            document.getElementById('pushers').textContent = data.financials.totalToPushers.toLocaleString();
        } catch (e) { 
            console.error("Update Failed", e); 
        }
    }

    function checkAuthAndLoad() {
        if (sessionStorage.getItem('dmg_admin_key')) {
            updateDashboard();
            // Start interval only once
            if (!window.dashboardInterval) {
                window.dashboardInterval = setInterval(updateDashboard, 60000);
            }
        }
    }

    checkAuthAndLoad();
</script>